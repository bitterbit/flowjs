<head>
    <script type="text/javascript" src="lib/createjs-2015.05.21.min.js"></script>
    <script type="text/javascript" src="src/flow.js"></script>
    <script type="text/javascript" src="src/flowitem.js"></script>
    <script type="text/javascript" src="src/flowconnector.js"></script>
    
    <script type="text/javascript" src="src/graph.js"></script>
</head>
<body>
    <title>Gurdians of the flow charts</title>
    <h1>Gurdians of the flow charts</h1>
    
    <canvas id="canvas1" width="500" height="300"></canvas>
    <canvas id="canvas2" width="500" height="300"></canvas>
    <canvas id="canvas3" width="500" height="300"></canvas>
    <canvas id="canvas4" width="500" height="300"></canvas>
    
    <script type="text/javascript">
    window.addEventListener("load", func);
    
    function func(){
        console.log("LOADED");
        
        var a = new DiGraph();
        a.addPaths([
            ["AA", "BB", "CC", "ZZ"],
            ["DD", "CC"],
            ["XX", "EE", "CC"],
            ["FF", "CC"],
            ["XX", "GG", "CC"]
        ]);
        
        var b = new DiGraph();
        b.addPaths([
            ["AA", "BB", "CC"],
            ["DD", "EE", "CC"]
        ]);
        
        var c = new DiGraph();
        c.addPaths([
            ["AA", "BB"],
            ["BB", "EE"],
            ["BB", "FF"],
            ["AA", "CC", "DD"]
        ]);
        
        var d = new DiGraph();
        d.addPaths([
            ["Peter Q", "Gamora", "Nova Prime", "Rocket"],
            ["Drax", "Groot", "Rocket"],
            ["Merdith Q", "Groot"]
        ]);
        
        new DiFlowChart("canvas1", a).draw();
        new DiFlowChart("canvas2", b).draw();
        new DiFlowChart("canvas4", d).draw();
        
        var cf = new DiFlowChart("canvas3", c);
        cf.draw();
        simuLoad(cf, c);    
    }
    
    
    function simuLoad(flowChart, graph){
        var walker = new GraphWalker(graph);
        walker.forEach(function(node){
            var start = Math.random() * 1000 * 5;
            var dur = Math.random() * 1000 * 5;
            simulateLoading(node.id, start);
            simulateDoneLoading(node.id, start + dur);
        }, this);
        
        
        function simulateLoading(itemId, timeout){
            setTimeout(function(){
                flowChart.updateItem(itemId, function(item){
                    item.flowItem.toggleFlashing();
                });
            }, timeout);
            
        }
        
        function simulateDoneLoading(itemId, timeout){
            setTimeout(function(){
                flowChart.updateItem(itemId, function(item){
                    item.flowItem.toggleFlashing();
                    item.flowItem.color = "red";
                    if (item.connectors === undefined){return}
                    item.connectors.forEach(function(conn){
                       conn.color = "red"; 
                    });
                });
            }, timeout);
        }
    }
        
    </script>

</body>

