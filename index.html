<head>
    <script type="text/javascript" src="lib/createjs-2015.05.21.min.js"></script>
    <script type="text/javascript" src="src/flow.js"></script>
    <script type="text/javascript" src="src/flow2.js"></script>
    <script type="text/javascript" src="src/flowitem.js"></script>
    <script type="text/javascript" src="src/flowconnector.js"></script>
    
    <script type="text/javascript" src="src/graph.js"></script>
    
</head>
<body>
    <title>Gurdians of the flow charts</title>
    <h1>Gurdians of the flow charts</h1>
    
    <canvas id="canvas1" width="500" height="300"></canvas>
    <canvas id="canvas2" width="500" height="300"></canvas>
    <canvas id="canvas3" width="500" height="300"></canvas>
    <canvas id="canvas4" width="500" height="300"></canvas>
    
    <script type="text/javascript">
    window.addEventListener("load", func);
    
    function func(){
        console.log("LOADED");
        
        var a = [ 
            [{id: "The Collector C", next: ["Groot"]}],
            [{id: "Groot", next: ["Peter Quill"]}],
            [{id: "Peter Quill", next: ["Drax"]}],
            [{id: "Drax", next: undefined}]
        ];
        
        var b = [ 
            [{id: "The Collector A", next: ["Meredith Quill"]}, {id:"z1", empty: true, next: undefined}, {id: "The Collector B", next:["Peter Quill Y", "Peter Quill X"]}],
            [{id: "Meredith Quill", next: ["Drax"]}, {id: "Peter Quill X", next: ["Drax"]}, {id: "Peter Quill Y", next: ["Drax"]} ],
            [{id: "Drax", next: undefined}]
        ];
        
        var c = [ 
            [{id: "The Collector C", next: ["Nebula B"]}, {id: "Peter Quill", next:["Nebula A"]}],
            [{id: "Nebula B", next: ["Drax"]}, {id: "Nebula A", next: ["Drax"]}],
            [{id: "Drax", next: undefined}]
        ];
        
        var d = [ 
            [{id: "Rocket", next: ["Ronan"]}],
            [{id: "Ronan", next: ["Korath", "Peter Quill", "Peter Quill X", "Peter Quill Y", "Meredith Quill"]}],
            [{id: "Korath", next: ["Groot", "z1", "z2"]}, {id: "Peter Quill"},  {id: "Peter Quill X"},  {id: "Peter Quill Y"}, {id: "Meredith Quill"}],
            [{id: "Groot"}, {id:"z1", empty: true}, {id:"z2", empty: true}, {id:"z3", empty: true}, {id:"z4", empty: true}]
        ];
        
        
        
        //new flowjs("canvas1", a).draw();
        //new flowjs("canvas2", b).draw();
        // new flowjs("canvas3", c).draw();
        
        
        // TODO: dont allow overlapping connectors (maybe allow only one hop?)
        gGraph = new DiGraph();
        gGraph.addPath([1,2,3,4]);
        gGraph.addPath([5,3,4]);
        gGraph.addPath([6,1,2,5,4]);
        new DiFlowChart("canvas1", gGraph).draw();
        
        
        gGraph = new DiGraph();
        gGraph.addPaths([
            [1,2,3,4],
            [5,3,4]
        ]);
        new DiFlowChart("canvas2", gGraph).draw();
        
        
        
        
        //df = new flowjs("canvas4", d);
        //df.draw();
        
        // for(var i=0;i<d.length; i++){
        //     var row = d[i];
        //     for(var k=0; k<row.length; k++){
        //         var item = row[k];
        //         var dur = Math.random() * 1000 * 10;
        //         simulateLoading(item.id, dur);
        //         simulateDoneLoading(item.id, dur*2);
        //     }
        // }
        
        function simulateLoading(itemId, timeout){
            setTimeout(function(){
                df.updateItem(itemId, function(item){
                    item.flowItem.toggleFlashing();
                });
            }, timeout);
            
        }
        
        function simulateDoneLoading(itemId, timeout){
            setTimeout(function(){
                df.updateItem(itemId, function(item){
                    item.flowItem.toggleFlashing();
                    item.flowItem.color = "red";
                    if (item.connectors === undefined){return}
                    item.connectors.forEach(function(conn){
                       conn.color = "red"; 
                    });
                });
            }, timeout);
        }
    
    }
        
    </script>

</body>

